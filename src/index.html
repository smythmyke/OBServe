<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OBServe for OBS</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- Welcome / Setup Modal -->
  <div class="welcome-overlay" id="welcome-overlay" hidden>
    <div class="welcome-modal">
      <div class="welcome-header">
        <h1 class="welcome-title"><span class="title-observe">OBServe</span> <span class="title-for">for</span> <span class="title-obs">OBS</span></h1>
        <p class="welcome-subtitle">AI-powered companion for OBS Studio</p>
      </div>

      <!-- Step 1: Open OBS -->
      <div class="welcome-step" id="welcome-step-1">
        <div class="welcome-step-number">1</div>
        <div class="welcome-step-content">
          <h3>Open OBS Studio</h3>
          <p>OBServe connects to OBS via WebSocket. Make sure OBS is running first.</p>
          <div class="welcome-step-actions">
            <button class="hw-btn" id="welcome-launch-obs">Open OBS</button>
            <button class="btn-secondary" id="welcome-obs-running">OBS is already open</button>
          </div>
          <p class="welcome-step-status" id="welcome-obs-status"></p>
        </div>
      </div>

      <!-- Step 2: WebSocket Setup -->
      <div class="welcome-step" id="welcome-step-2">
        <div class="welcome-step-number">2</div>
        <div class="welcome-step-content">
          <h3>Enable WebSocket Server</h3>
          <p>In OBS, go to <b>Tools</b> &rarr; <b>WebSocket Server Settings</b></p>
          <img src="images/obs-websocket-menu.png" class="welcome-screenshot" alt="OBS Tools menu showing WebSocket Server Settings">
          <p>Click <b>Show Connect Info</b> and copy the <b>Server Password</b>:</p>
          <img src="images/obs-websocket-password.png" class="welcome-screenshot" alt="OBS WebSocket Connect Info showing Server Password">
          <div class="welcome-password-row">
            <label>Password</label>
            <input type="password" id="welcome-password" class="store-license-input" placeholder="Paste password here (or leave blank if none)">
          </div>
        </div>
      </div>

      <!-- Connect -->
      <div class="welcome-connect-section">
        <button class="hw-btn welcome-connect-btn" id="welcome-connect-btn">Connect to OBS</button>
        <p class="welcome-connect-status" id="welcome-connect-status"></p>
      </div>

      <div class="welcome-footer">
        <label class="welcome-dismiss-label">
          <input type="checkbox" id="welcome-dismiss-check"> Don't show this again
        </label>
        <button class="btn-secondary welcome-skip-btn" id="welcome-skip-btn">Skip</button>
      </div>
    </div>
  </div>

  <div class="rack-frame">

    <div class="wood-panel">
      <div class="wood-screw"></div><div class="wood-screw"></div>
      <div class="wood-screw"></div><div class="wood-screw"></div>
      <div class="wood-screw"></div><div class="wood-screw"></div>
      <div class="wood-screw"></div>
    </div>

    <div class="rack-body">

      <div class="title-bar-wrapper">
        <div class="title-bar" data-tauri-drag-region>
          <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
          <div class="mod-screw bl"></div><div class="mod-screw br"></div>
          <h1><span class="title-observe">OBServe</span> <span class="title-for">for</span> <span class="title-obs">OBS</span></h1>

          <div class="grip-strip" data-tauri-drag-region>
            <div class="grip-ridges" data-tauri-drag-region></div>
          </div>

          <div class="title-bar-right">
            <button id="btn-settings" class="settings-btn" title="Settings">&#9881;</button>
            <button id="btn-hamburger" class="hamburger-btn" title="Menu">
              <span class="hamburger-line"></span>
              <span class="hamburger-line"></span>
              <span class="hamburger-line"></span>
            </button>
            <div class="window-controls">
              <button class="win-btn" id="win-minimize" title="Minimize"><span class="win-icon">&#x2014;</span></button>
              <button class="win-btn" id="win-maximize" title="Maximize"><span class="win-icon">&#x25A1;</span></button>
              <button class="win-btn" id="win-close" title="Close"><span class="win-icon">&#x2715;</span></button>
            </div>
          </div>

          <div id="settings-dropdown" class="settings-dropdown">
            <div class="settings-row">
              <label>Host <input type="text" id="obs-host" value="localhost"></label>
            </div>
            <div class="settings-row">
              <label>Port <input type="number" id="obs-port" value="4455"></label>
            </div>
            <div class="settings-row">
              <label>Password <input type="password" id="obs-password" placeholder="(optional)"></label>
            </div>
            <div class="settings-row">
              <label>Gemini API Key <input type="password" id="gemini-api-key" placeholder="(for AI features)"></label>
            </div>
            <div class="toggle-row">
              <label><input type="checkbox" id="auto-launch-obs"> Launch OBS on startup</label>
            </div>
            <div class="toggle-row">
              <label><input type="checkbox" id="enable-voice-input" checked> Enable voice input</label>
            </div>
            <div class="settings-divider"></div>
            <div class="settings-section-label">Panels</div>
            <div id="panel-toggles" class="panel-toggles"></div>
            <button id="btn-save-settings">Save</button>
          </div>

          <div id="hamburger-dropdown" class="hamburger-dropdown">
            <button class="hamburger-menu-item" id="btn-about">About OBServe</button>
          </div>
        </div>

        <div class="toolbar">
          <div class="toolbar-left">
            <div class="toolbar-group">
              <span class="toolbar-label">Mode</span>
              <button class="toggle-btn" data-mode="audio">Audio</button>
              <button class="toggle-btn active" data-mode="audio-video">A+V</button>
              <button class="toggle-btn" data-mode="video">Video</button>
            </div>
            <div class="toolbar-group">
              <span class="toolbar-label">Detail</span>
              <button class="toggle-btn active" data-complexity="simple">Simple</button>
              <button class="toggle-btn" data-complexity="advanced">Advanced</button>
            </div>
            <div class="toolbar-group">
              <button class="toggle-btn store-btn" id="btn-store">Store</button>
            </div>
          </div>
          <div class="toolbar-right">
            <p id="connection-error" class="header-error" hidden></p>
            <button id="btn-connect" class="hw-btn">Connect</button>
            <button id="btn-disconnect" class="hw-btn" disabled>Disconnect</button>
            <span class="led" id="connection-led"></span>
            <span id="connection-badge" class="badge disconnected">Disconnected</span>
          </div>
        </div>
      </div>

      <section class="module panel" id="store-panel" data-panel="store" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Module Store</span>
        <div class="store-header">
          <h2>Module Store</h2>
          <span class="store-tagline">Unlock powerful modules &mdash; $4.99 each, one-time purchase</span>
          <button class="btn-secondary store-close-btn" id="btn-store-close">&times; Close</button>
        </div>
        <div class="store-grid" id="store-grid"></div>
        <div class="store-activation">
          <div class="store-activation-header">
            <span class="store-activation-label">Activate License</span>
          </div>
          <div class="store-activation-row">
            <input type="text" id="store-license-key" class="store-license-input" placeholder="Enter 4-digit code or license key...">
            <button class="hw-btn" id="btn-activate-license">Activate</button>
          </div>
          <p class="store-activation-status" id="store-activation-status"></p>
          <div class="store-license-info" id="store-license-info" hidden>
            <span id="store-license-email"></span>
            <span id="store-license-count"></span>
            <button class="btn-secondary store-deactivate-btn" id="btn-restore-purchases">Restore Purchases</button>
            <button class="btn-secondary store-deactivate-btn" id="btn-deactivate-license">Deactivate</button>
          </div>
          <div class="store-recovery">
            <a href="#" class="store-recovery-link" id="store-recovery-toggle">Forgot your license key?</a>
            <div class="store-recovery-form" id="store-recovery-form" hidden>
              <div class="store-activation-row">
                <input type="email" id="store-recovery-email" class="store-license-input" placeholder="Enter your purchase email...">
                <button class="hw-btn" id="btn-recover-license">Recover</button>
              </div>
              <p class="store-activation-status" id="store-recovery-status"></p>
            </div>
          </div>
        </div>
      </section>

      <section class="module panel" id="routing-panel" data-panel="routing" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Audio Routing</span>
        <div class="routing-header">
          <h2>Audio Routing</h2>
          <div class="routing-buttons">
            <button class="btn-secondary" id="btn-check-routing">Check Routing</button>
            <button id="btn-apply-setup" disabled>One-Click Setup</button>
          </div>
        </div>
        <div id="routing-results"></div>
      </section>

      <section class="module panel" id="preflight-panel" data-panel="preflight" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Pre-Flight</span>
        <div class="preflight-header">
          <h2>Pre-Flight Check</h2>
          <div class="preflight-buttons">
            <button class="btn-secondary" id="btn-preflight-record">Check for Recording</button>
            <button class="btn-secondary" id="btn-preflight-stream">Check for Streaming</button>
          </div>
        </div>
        <div id="preflight-summary" hidden>
          <div class="pf-summary-bar">
            <span class="pf-count pass" id="pf-pass">0 pass</span>
            <span class="pf-count warn" id="pf-warn">0 warn</span>
            <span class="pf-count fail" id="pf-fail">0 fail</span>
          </div>
        </div>
        <div id="preflight-results"></div>
      </section>

      <section class="module panel" id="stream-record-panel" data-panel="stream-record" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Stream &amp; Record</span>
        <h2>Stream &amp; Record</h2>
        <div class="stream-record-buttons">
          <button class="sr-btn" id="btn-toggle-stream" title="Ctrl+Shift+S">Start Stream</button>
          <button class="sr-btn" id="btn-toggle-record" title="Ctrl+Shift+R">Start Record</button>
        </div>
        <div class="sr-shortcuts-hint">Ctrl+Shift+S Stream &nbsp;|&nbsp; Ctrl+Shift+R Record</div>
        <div class="stream-record-status">
          <span id="sr-stream-status" class="sr-status">Stream: Off</span>
          <span id="sr-record-status" class="sr-status">Record: Off</span>
        </div>
        <div class="live-caption-controls" id="live-caption-controls">
          <div class="live-caption-toggle-row">
            <label class="duck-switch">
              <input type="checkbox" id="live-captions-enabled">
              <span class="duck-slider-track"></span>
            </label>
            <span id="live-caption-label" class="live-caption-label">Live Captions</span>
            <span id="live-caption-status" class="live-caption-status"></span>
          </div>
          <div class="live-caption-settings" id="live-caption-settings" hidden>
            <div class="live-caption-row">
              <label>Theme</label>
              <select id="live-caption-theme">
                <option value="clean" style="font-family:'Inter',sans-serif">Clean</option>
                <option value="bold_impact" style="font-family:'Poppins',sans-serif;font-weight:900">Bold Impact</option>
                <option value="neon" style="font-family:'Inter',sans-serif;font-weight:700">Neon</option>
                <option value="party" style="font-family:'Poppins',sans-serif;font-weight:700">Party</option>
                <option value="retro" style="font-family:'JetBrains Mono',monospace">Retro</option>
                <option value="handwritten" style="font-family:'Poppins',sans-serif;font-style:italic">Handwritten</option>
              </select>
            </div>
            <div class="live-caption-row">
              <label>Fade after</label>
              <select id="live-caption-fade">
                <option value="0">Never</option>
                <option value="3000">3s</option>
                <option value="5000" selected>5s</option>
                <option value="10000">10s</option>
              </select>
            </div>
            <div class="live-caption-row">
              <label>Box Width</label>
              <input type="range" id="live-caption-width" min="200" max="1920" value="800">
              <span id="live-caption-width-val">800</span>
            </div>
            <div class="live-caption-row">
              <label>Box Height</label>
              <input type="range" id="live-caption-height" min="40" max="400" value="100">
              <span id="live-caption-height-val">100</span>
            </div>
            <button class="btn-secondary" id="btn-live-caption-export-srt">Export SRT</button>
          </div>
        </div>
      </section>

      <section class="module panel" id="scenes-panel" data-panel="scenes" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Scenes</span>
        <h2>Scenes</h2>
        <div class="scenes-toolbar">
            <button class="scene-add-btn" id="btn-create-scene" title="Create new scene">+ New Scene</button>
            <button class="toggle-btn" id="btn-studio-mode" title="Studio Mode">Studio</button>
        </div>
        <div class="scene-preview-container" id="scene-preview-container">
            <div class="scene-preview-panes" id="scene-preview-panes">
                <div class="scene-preview-pane" id="scene-preview-program">
                    <img class="scene-preview-img" src="" alt="Program" draggable="false">
                    <div class="scene-preview-label">PROGRAM</div>
                </div>
            </div>
            <div class="scene-preview-resize-handle" id="scene-preview-resize-handle"></div>
        </div>
        <div id="scenes-grid" class="scenes-grid"></div>
      </section>

      <section class="module panel" id="webcam-panel" data-panel="webcam" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Cameras</span>
        <div class="webcam-header">
          <h2>Cameras</h2>
          <button class="btn-secondary" id="btn-refresh-webcams">Refresh</button>
        </div>
        <div id="webcam-list"></div>
        <div id="webcam-guide" class="webcam-guide" hidden></div>
      </section>

      <section class="module panel" id="obs-info-panel" data-panel="obs-info" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">OBS Info</span>
        <h2>OBS Info</h2>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Version</span>
            <span id="obs-version">&mdash;</span>
          </div>
          <div class="info-item">
            <span class="info-label">Active FPS</span>
            <span id="obs-fps">&mdash;</span>
          </div>
          <div class="info-item">
            <span class="info-label">CPU (OBS)</span>
            <span id="obs-cpu">&mdash;</span>
          </div>
          <div class="info-item">
            <span class="info-label">Memory (OBS)</span>
            <span id="obs-memory">&mdash;</span>
          </div>
          <div class="info-item">
            <span class="info-label">Stream</span>
            <span id="obs-stream-status">&mdash;</span>
          </div>
          <div class="info-item">
            <span class="info-label">Record</span>
            <span id="obs-record-status">&mdash;</span>
          </div>
          <div class="info-item">
            <span class="info-label">Canvas</span>
            <span id="obs-canvas-res">&mdash;</span>
          </div>
          <div class="info-item">
            <span class="info-label">Output</span>
            <span id="obs-output-res">&mdash;</span>
          </div>
          <div class="info-item">
            <span class="info-label">Dropped Frames</span>
            <span id="obs-dropped-frames">&mdash;</span>
          </div>
        </div>

        <h3>Scenes</h3>
        <ul id="scene-list" class="scene-list"></ul>
      </section>

      <section class="module panel" id="system-panel" data-panel="system" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">System</span>
        <h2>System Resources</h2>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">CPU (System)</span>
            <span id="sys-cpu">&mdash;</span>
          </div>
          <div class="info-item">
            <span class="info-label">RAM</span>
            <span id="sys-ram">&mdash;</span>
          </div>
          <div class="info-item">
            <span class="info-label">Disk Free</span>
            <span id="sys-disk">&mdash;</span>
          </div>
        </div>
        <h3>Displays</h3>
        <ul id="display-list" class="scene-list"></ul>
      </section>

      <section class="module panel" id="audio-panel" data-panel="audio-devices">
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Audio Devices</span>
        <h2>Audio Devices</h2>
        <div id="audio-devices-loading">Loading devices...</div>
        <p id="audio-error" class="error" hidden></p>

        <div id="audio-device-widgets" hidden>
          <div class="device-widget" id="input-widget">
            <div class="widget-header">
              <div class="widget-name-left">
                <span class="hw-device-name" id="input-hw-name"></span>
              </div>
              <span class="flow-arrow">&rarr;</span>
              <div class="widget-name-right">
                <span class="fat-quote-name accent-red">My Mic</span>
                <span class="obs-source-name" id="input-obs-name">Aux</span>
              </div>
            </div>

            <div class="device-widget-top">
              <select class="device-select" id="input-device-select"></select>
              <button class="preferred-btn" id="input-preferred-btn" title="Set as preferred">&#9734;</button>
            </div>

            <div class="dual-knob-row">
              <div class="knob-col knob-col-secondary">
                <webaudio-knob id="input-knob" min="0" max="100" step="1" value="0"
                  diameter="60" colors="#5a5040;#0c0a06;#1a1714"></webaudio-knob>
                <div class="knob-info">
                  <span class="device-vol-pct" id="input-vol-pct">--%</span>
                  <button class="device-mute-btn" id="input-mute-btn">Mute</button>
                </div>
              </div>

              <span class="flow-arrow-mid">&rarr;</span>

              <div class="knob-col knob-col-primary" id="input-obs-knob-col">
                <div class="gauge-knob-container">
                  <svg class="peak-gauge" viewBox="0 0 120 120" width="120" height="120">
                    <circle class="gauge-track" cx="60" cy="60" r="54"/>
                    <circle class="gauge-fill" id="input-gauge-fill" cx="60" cy="60" r="54"/>
                    <circle class="gauge-track peak-track" cx="60" cy="60" r="44"/>
                    <circle class="gauge-fill peak-fill" id="input-peak-fill" cx="60" cy="60" r="44"/>
                  </svg>
                  <div class="knob-overlay">
                    <webaudio-knob id="input-obs-knob" min="-100" max="26" step="0.1" value="0"
                      diameter="80" colors="#d4a040;#0c0a06;#2a2620"></webaudio-knob>
                  </div>
                </div>
                <div class="knob-info">
                  <span class="obs-vol-db" id="input-obs-db">-- dB</span>
                  <div class="knob-btn-row">
                    <button class="obs-mute-btn" id="input-obs-mute">Mute</button>
                    <button class="monitor-btn" id="input-monitor-btn" title="Monitor Off">MON</button>
                    <span class="led led-off" id="input-monitor-led"></span>
                  </div>
                </div>
              </div>
            </div>

            <div class="filter-knobs" id="input-filter-knobs"></div>
            <div class="cal-trigger-row">
              <button class="btn-secondary" id="btn-calibrate-mic" title="Calibrate microphone">Calibrate</button>
              <select class="cal-profile-select" id="cal-profile-select" title="Calibration profiles"></select>
              <span class="cal-status" id="cal-last-run"></span>
            </div>
          </div>

          <div class="device-widget" id="output-widget">
            <div class="widget-header">
              <div class="widget-name-left">
                <span class="fat-quote-name accent-green">My Speakers</span>
                <span class="obs-source-name" id="output-obs-name">Desktop Audio</span>
              </div>
              <span class="flow-arrow">&rarr;</span>
              <div class="widget-name-right">
                <span class="hw-device-name" id="output-hw-name"></span>
              </div>
            </div>

            <div class="device-widget-top">
              <select class="device-select" id="output-device-select"></select>
              <button class="preferred-btn" id="output-preferred-btn" title="Set as preferred">&#9734;</button>
            </div>

            <div class="dual-knob-row">
              <div class="knob-col knob-col-primary" id="output-obs-knob-col">
                <div class="gauge-knob-container">
                  <svg class="peak-gauge" viewBox="0 0 120 120" width="120" height="120">
                    <circle class="gauge-track" cx="60" cy="60" r="54"/>
                    <circle class="gauge-fill" id="output-gauge-fill" cx="60" cy="60" r="54"/>
                    <circle class="gauge-track peak-track" cx="60" cy="60" r="44"/>
                    <circle class="gauge-fill peak-fill" id="output-peak-fill" cx="60" cy="60" r="44"/>
                  </svg>
                  <div class="knob-overlay">
                    <webaudio-knob id="output-obs-knob" min="-100" max="26" step="0.1" value="0"
                      diameter="80" colors="#d4a040;#0c0a06;#2a2620"></webaudio-knob>
                  </div>
                </div>
                <div class="knob-info">
                  <span class="obs-vol-db" id="output-obs-db">-- dB</span>
                  <div class="knob-btn-row">
                    <button class="obs-mute-btn" id="output-obs-mute">Mute</button>
                    <button class="monitor-btn" id="output-monitor-btn" title="Monitor Off">MON</button>
                    <span class="led led-off" id="output-monitor-led"></span>
                  </div>
                </div>
              </div>

              <span class="flow-arrow-mid">&rarr;</span>

              <div class="knob-col knob-col-secondary">
                <webaudio-knob id="output-knob" min="0" max="100" step="1" value="0"
                  diameter="60" colors="#5a5040;#0c0a06;#1a1714"></webaudio-knob>
                <div class="knob-info">
                  <span class="device-vol-pct" id="output-vol-pct">--%</span>
                  <button class="device-mute-btn" id="output-mute-btn">Mute</button>
                </div>
              </div>
            </div>

            <div class="filter-knobs" id="output-filter-knobs"></div>
          </div>
        </div>
      </section>

      <section class="module panel" id="calibration-panel" data-panel="calibration" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Mic Calibration</span>
        <div class="cal-header">
          <h2>Audio Calibration Wizard</h2>
          <button class="btn-secondary" id="btn-cal-cancel">Cancel</button>
        </div>
        <div class="cal-progress-bar">
          <div class="cal-progress-steps" id="cal-progress-steps"></div>
          <div class="cal-progress-track"><div class="cal-progress-fill" id="cal-progress-fill"></div></div>
        </div>
        <div class="cal-content" id="cal-content"></div>
        <div class="cal-existing-warning" id="cal-existing-warning" hidden>
          <p>This source already has filters. What would you like to do?</p>
          <div class="cal-warning-buttons">
            <button class="hw-btn" id="btn-cal-replace">Replace All</button>
            <button class="hw-btn" id="btn-cal-keep">Keep Both</button>
            <button class="hw-btn" id="btn-cal-cancel-apply">Cancel</button>
          </div>
        </div>
      </section>

      <section class="module panel" id="pro-spectrum-panel" data-panel="pro-spectrum" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Pro Spectrum</span>
        <div class="spectrum-toolbar">
          <h2>Pro Spectrum</h2>
          <div class="spectrum-actions">
            <div class="spectrum-mode-group">
              <span class="toolbar-label">View</span>
              <button class="toggle-btn active" data-spectrum-mode="simple">Simple</button>
              <button class="toggle-btn" data-spectrum-mode="daw">DAW</button>
            </div>
            <select class="spectrum-source-select" id="spectrum-source-select">
              <option value="">Select source...</option>
            </select>
            <button class="btn-secondary" id="btn-spectrum-reset-lufs" title="Reset LUFS">Reset</button>
          </div>
        </div>
        <canvas class="spectrum-canvas" id="spectrum-canvas" width="600" height="150"></canvas>
        <div class="spectrum-lufs-bar" id="spectrum-lufs-bar">
          <span class="lufs-label">M <span id="lufs-momentary">--</span></span>
          <span class="lufs-label">S <span id="lufs-short-term">--</span></span>
          <span class="lufs-label">I <span id="lufs-integrated">--</span></span>
          <span class="lufs-label">TP <span id="lufs-true-peak">--</span></span>
        </div>
        <div class="spectrum-knobs" id="spectrum-knobs"></div>
      </section>

      <section class="module panel" id="pads-panel" data-panel="pads" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">PADS</span>
        <div class="pads-toolbar">
          <h2>Pads</h2>
          <div class="pads-actions">
            <div class="pads-bank-selector" id="pads-bank-selector">
              <button class="pads-bank-btn active" data-bank="A">A</button>
              <button class="pads-bank-btn" data-bank="B">B</button>
              <button class="pads-bank-btn" data-bank="C">C</button>
              <button class="pads-bank-btn" data-bank="D">D</button>
            </div>
            <div class="pads-master-vol">
              <span class="pads-master-label">Vol</span>
              <webaudio-knob id="pads-master-knob" min="0" max="100" step="1" value="80"
                diameter="36" colors="#d4a040;#0c0a06;#2a2620"></webaudio-knob>
              <span class="pads-master-pct" id="pads-master-pct">80%</span>
            </div>
          </div>
        </div>
        <div class="pads-transport" id="pads-transport">
          <button class="pads-transport-btn" id="pads-rec-btn" title="Record to selected pad">●</button>
          <button class="pads-transport-btn" id="pads-stop-btn" title="Stop recording" disabled>■</button>
          <select class="pads-source-select" id="pads-source-select">
            <option value="mic">Microphone</option>
          </select>
          <canvas class="pads-rec-waveform" id="pads-rec-waveform" width="200" height="32"></canvas>
          <div class="pads-input-meter" id="pads-input-meter">
            <div class="pads-meter-fill" id="pads-meter-fill"></div>
          </div>
          <span class="pads-rec-status" id="pads-rec-status"></span>
        </div>
        <div class="pads-preset-bar" id="pads-preset-bar">
          <span class="pads-preset-name" id="pads-preset-name">No preset</span>
          <button class="pads-preset-btn" id="pads-save-btn" title="Save">Save</button>
          <button class="pads-preset-btn" id="pads-saveas-btn" title="Save As">Save As</button>
          <button class="pads-preset-btn" id="pads-load-btn" title="Load">Load</button>
          <button class="pads-preset-btn" id="pads-preset-menu-btn" title="More">&#9881;</button>
        </div>
        <div class="pads-editor" id="pads-editor" hidden>
          <div class="pads-editor-toolbar">
            <span class="pads-editor-title" id="pads-editor-title">Editor</span>
            <button class="pads-preset-btn" id="pads-ed-normalize">Normalize</button>
            <button class="pads-preset-btn" id="pads-ed-reverse">Reverse</button>
            <button class="pads-preset-btn" id="pads-ed-fadein">Fade In</button>
            <button class="pads-preset-btn" id="pads-ed-fadeout">Fade Out</button>
            <button class="pads-preset-btn" id="pads-ed-undo">Undo</button>
            <div class="pads-ed-knob-group">
              <label>Gain</label>
              <webaudio-knob id="pads-ed-gain" min="-12" max="12" step="0.5" value="0"
                diameter="30" colors="#d4a040;#0c0a06;#2a2620"></webaudio-knob>
              <span id="pads-ed-gain-val">0 dB</span>
            </div>
            <div class="pads-ed-knob-group">
              <label>Pitch</label>
              <webaudio-knob id="pads-ed-pitch" min="50" max="200" step="1" value="100"
                diameter="30" colors="#d4a040;#0c0a06;#2a2620"></webaudio-knob>
              <span id="pads-ed-pitch-val">1.00x</span>
            </div>
            <div class="pads-ed-knob-group">
              <label>Pan</label>
              <webaudio-knob id="pads-ed-pan" min="-100" max="100" step="1" value="0"
                diameter="30" colors="#d4a040;#0c0a06;#2a2620"></webaudio-knob>
              <span id="pads-ed-pan-val">C</span>
            </div>
            <button class="pads-browser-close" id="pads-ed-close">&times;</button>
          </div>
          <div class="pads-ed-fx-bar" id="pads-ed-fx-bar">
            <span class="pads-editor-title">FX</span>
            <div class="pads-ed-fx-slot" data-slot="0">
              <select class="pads-ed-fx-select" data-slot="0">
                <option value="">—</option>
                <option value="lowpass">Low-Pass</option>
                <option value="highpass">High-Pass</option>
                <option value="reverb">Reverb</option>
                <option value="delay">Delay</option>
                <option value="bitcrusher">Crush</option>
              </select>
              <div class="pads-ed-fx-params" data-slot="0"></div>
            </div>
            <div class="pads-ed-fx-slot" data-slot="1">
              <select class="pads-ed-fx-select" data-slot="1">
                <option value="">—</option>
                <option value="lowpass">Low-Pass</option>
                <option value="highpass">High-Pass</option>
                <option value="reverb">Reverb</option>
                <option value="delay">Delay</option>
                <option value="bitcrusher">Crush</option>
              </select>
              <div class="pads-ed-fx-params" data-slot="1"></div>
            </div>
            <div class="pads-ed-fx-slot" data-slot="2">
              <select class="pads-ed-fx-select" data-slot="2">
                <option value="">—</option>
                <option value="lowpass">Low-Pass</option>
                <option value="highpass">High-Pass</option>
                <option value="reverb">Reverb</option>
                <option value="delay">Delay</option>
                <option value="bitcrusher">Crush</option>
              </select>
              <div class="pads-ed-fx-params" data-slot="2"></div>
            </div>
            <div class="pads-ed-knob-group">
              <label>Send</label>
              <webaudio-knob id="pads-ed-send" min="0" max="100" step="1" value="0"
                diameter="30" colors="#d4a040;#0c0a06;#2a2620"></webaudio-knob>
              <span id="pads-ed-send-val">0%</span>
            </div>
            <button class="pads-preset-btn" id="pads-ed-bounce">Bounce</button>
          </div>
          <div class="pads-ed-waveform-wrap" id="pads-ed-waveform-wrap">
            <canvas class="pads-ed-waveform" id="pads-ed-waveform" height="100"></canvas>
            <div class="pads-ed-handle start" id="pads-ed-handle-start"></div>
            <div class="pads-ed-handle end" id="pads-ed-handle-end"></div>
            <div class="pads-ed-cursor" id="pads-ed-cursor"></div>
          </div>
        </div>
        <div class="pads-grid-area">
          <div class="pads-utilities" id="pads-utilities">
            <button class="pads-util-btn" id="pads-mode-noterepeat" title="Note Repeat">NoteRpt</button>
            <select class="pads-rate-select" id="pads-rate-select" title="Repeat rate" hidden>
              <option value="4">1/4</option>
              <option value="8" selected>1/8</option>
              <option value="12">1/8T</option>
              <option value="16">1/16</option>
              <option value="24">1/16T</option>
              <option value="32">1/32</option>
            </select>
            <button class="pads-util-btn" id="pads-mode-16levels" title="16 Levels">16 Lvl</button>
            <select class="pads-16lvl-param" id="pads-16lvl-param" title="16 Levels parameter" hidden>
              <option value="velocity">Velocity</option>
              <option value="pitch">Pitch</option>
              <option value="filter">Filter</option>
              <option value="decay">Decay</option>
            </select>
            <button class="pads-util-btn" id="pads-mode-fulllevel" title="Full Level">FullLvl</button>
          </div>
          <div class="pads-grid" id="pads-grid"></div>
        </div>
        <div class="pads-browser" id="pads-browser" hidden>
          <div class="pads-browser-header"><span>Samples</span>
            <button class="pads-browser-close" id="pads-browser-close">&times;</button></div>
          <div class="pads-browser-path" id="pads-browser-path"></div>
          <div class="pads-browser-list" id="pads-browser-list"></div>
        </div>
      </section>

      <section class="module panel" id="mixer-panel" data-panel="mixer" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Mixer</span>
        <h2>OBServe Audio Mixer</h2>
        <div class="mixer-toolbar" id="mixer-toolbar">
          <span class="toolbar-label">Monitor</span>
          <div class="monitor-preset-group">
            <button class="monitor-preset-btn" data-monitor-preset="recording"
              title="All monitoring off — clean recording, no feedback risk">Recording</button>
            <button class="monitor-preset-btn" data-monitor-preset="headphone"
              title="Mic off, desktop monitor-only — hear your mix without mic feedback">Headphone Mix</button>
            <button class="monitor-preset-btn" data-monitor-preset="preview"
              title="All sources monitor-only — hear everything with filters in headphones">Full Preview</button>
            <button class="monitor-preset-btn" data-monitor-preset="live"
              title="All sources monitor+output — live performance, use headphones!">Live Perf</button>
          </div>
        </div>
        <div id="mixer-list"></div>
      </section>

      <section class="module panel" id="ducking-panel" data-panel="ducking" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Auto-Duck</span>
        <h2>Auto-Duck</h2>
        <div class="ducking-controls">
          <div class="ducking-toggle-row">
            <label class="duck-switch">
              <input type="checkbox" id="duck-enabled">
              <span class="duck-slider-track"></span>
            </label>
            <span class="duck-led led-off" id="duck-led"></span>
            <span class="duck-status-text" id="duck-status-text">Disabled</span>
          </div>
          <div class="ducking-sources">
            <div class="duck-source-row">
              <label class="duck-label">Trigger (voice)</label>
              <select class="duck-select" id="duck-trigger-select"><option value="">—</option></select>
            </div>
            <div class="duck-source-row">
              <label class="duck-label">Target (duck)</label>
              <select class="duck-select" id="duck-target-select"><option value="">—</option></select>
            </div>
          </div>
          <div class="ducking-params">
            <div class="duck-param">
              <label>Threshold</label>
              <input type="range" id="duck-threshold" min="-60" max="-10" step="1" value="-40">
              <span class="duck-param-val" id="duck-threshold-val">-40 dB</span>
            </div>
            <div class="duck-param">
              <label>Duck Amount</label>
              <input type="range" id="duck-amount" min="-30" max="0" step="1" value="-14">
              <span class="duck-param-val" id="duck-amount-val">-14 dB</span>
            </div>
            <div class="duck-param">
              <label>Attack</label>
              <input type="range" id="duck-attack" min="10" max="500" step="10" value="50">
              <span class="duck-param-val" id="duck-attack-val">50 ms</span>
            </div>
            <div class="duck-param">
              <label>Hold</label>
              <input type="range" id="duck-hold" min="100" max="3000" step="50" value="500">
              <span class="duck-param-val" id="duck-hold-val">500 ms</span>
            </div>
            <div class="duck-param">
              <label>Release</label>
              <input type="range" id="duck-release" min="50" max="2000" step="50" value="300">
              <span class="duck-param-val" id="duck-release-val">300 ms</span>
            </div>
          </div>
        </div>
      </section>

      <section class="module panel" id="app-capture-panel" data-panel="app-capture" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">App Capture</span>
        <h2>App Capture</h2>
        <div class="app-capture-controls">
          <div class="app-capture-add-row">
            <select class="app-capture-select" id="app-capture-select"><option value="">Select audio source...</option></select>
            <button class="btn-secondary" id="btn-app-capture-refresh" title="Refresh process list">&#x21bb;</button>
            <button class="hw-btn" id="btn-app-capture-add">Add Capture</button>
          </div>
          <div id="app-capture-empty" class="app-capture-empty" hidden>No audio detected. Play audio in an app, then click refresh.</div>
          <div class="app-capture-list" id="app-capture-list"></div>
          <p class="app-capture-hint">Only apps currently producing audio are shown.</p>
        </div>
      </section>

      <section class="module panel" id="filters-panel" data-panel="filters" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Signal Chain</span>
        <div class="signal-chain-toolbar">
          <h2>Signal Chain</h2>
          <div class="signal-chain-actions">
            <div class="sc-preset-dropdown-wrap">
              <button class="btn-secondary" id="btn-sc-presets">Smart Presets &#9662;</button>
              <div class="sc-preset-dropdown" id="sc-preset-dropdown" hidden></div>
            </div>
            <button class="btn-secondary" id="btn-sc-new-group">+ New Group</button>
            <button class="btn-secondary" id="btn-sc-browse-vsts">Browse VSTs</button>
          </div>
        </div>
        <div id="sc-replace-dialog" class="sc-dialog" hidden>
          <p>Preset groups already exist. Add alongside or replace?</p>
          <div class="sc-dialog-buttons">
            <button class="hw-btn" id="btn-sc-add">Add</button>
            <button class="hw-btn" id="btn-sc-replace">Replace</button>
            <button class="hw-btn" id="btn-sc-cancel-preset">Cancel</button>
          </div>
        </div>
        <div id="sc-newgroup-dialog" class="sc-dialog" hidden>
          <label>Group Name: <input type="text" id="sc-newgroup-name" maxlength="30"></label>
          <div class="sc-dialog-buttons">
            <button class="hw-btn" id="btn-sc-create-group">Create</button>
            <button class="hw-btn" id="btn-sc-cancel-group">Cancel</button>
          </div>
        </div>
        <div id="filters-chain-list"></div>
        <div id="vst-browser" class="vst-browser" hidden>
          <div class="vst-browser-header">
            <input type="text" id="vst-browser-search" class="vst-browser-search" placeholder="Search plugins...">
            <button class="btn-secondary" id="btn-vst-browser-close">Back to Chain</button>
          </div>
          <div class="vst-browser-categories" id="vst-browser-categories"></div>
          <div class="vst-browser-grid" id="vst-browser-grid"></div>
        </div>
      </section>

      <section class="module panel" id="video-editor-panel" data-panel="video-editor" hidden>
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">Video Editor</span>
        <div class="ve-toolbar">
          <h2>Video Editor</h2>
          <div class="ve-actions">
            <span class="ve-ffmpeg-badge" id="ve-ffmpeg-badge"></span>
            <button class="btn-secondary" id="btn-ve-browse-files">Files</button>
            <button class="btn-secondary" id="btn-ve-save-project" disabled>Save Project</button>
            <button class="btn-secondary" id="btn-ve-export" disabled>Export</button>
          </div>
        </div>

        <div class="ve-player-container" id="ve-player-container">
          <div class="ve-no-video" id="ve-no-video">
            <p>No video loaded</p>
            <p class="ve-hint">Record in OBS and it will appear here, or browse your files</p>
          </div>
          <div class="ve-video-wrapper" id="ve-video-wrapper" hidden>
            <video id="ve-video" controls></video>
            <canvas id="ve-overlay-canvas"></canvas>
          </div>
        </div>

        <div class="ve-info-bar" id="ve-info-bar" hidden>
          <span class="ve-info-item" id="ve-filename"></span>
          <span class="ve-info-item" id="ve-duration"></span>
          <span class="ve-info-item" id="ve-resolution"></span>
          <span class="ve-info-item" id="ve-codec"></span>
        </div>

        <div class="ve-edit-bay" id="ve-edit-bay" hidden>
          <div class="ve-timeline-container" id="ve-timeline-container" hidden>
            <canvas id="ve-timeline" height="60"></canvas>
            <div class="ve-timeline-controls">
              <button class="ve-ctrl-btn" id="btn-ve-trim-in" title="Mark where the video should start (keyboard: [)">Trim Start</button>
              <button class="ve-ctrl-btn" id="btn-ve-trim-out" title="Mark where the video should end (keyboard: ])">Trim End</button>
              <button class="ve-ctrl-btn" id="btn-ve-split" title="Cut the video at the current position (keyboard: S)">Split</button>
              <button class="ve-ctrl-btn" id="btn-ve-delete-seg" title="Remove the selected segment (keyboard: Del)">Delete</button>
              <button class="ve-ctrl-btn" id="btn-ve-undo" title="Undo last edit (keyboard: Ctrl+Z)">Undo</button>
            </div>
          </div>

          <div class="ve-overlay-toolbar" id="ve-overlay-toolbar" hidden>
            <button class="ve-ctrl-btn" id="btn-ve-add-text">+ Text</button>
            <button class="ve-ctrl-btn" id="btn-ve-add-image">+ Image</button>
            <button class="ve-ctrl-btn" id="btn-ve-add-watermark">+ Watermark</button>
            <button class="ve-ctrl-btn ve-narrate-btn" id="btn-ve-narrate">Narrate</button>
            <button class="ve-ctrl-btn" id="btn-ve-captions-toggle">Captions (0)</button>
            <div class="ve-overlay-list" id="ve-overlay-list"></div>
          </div>

          <div class="ve-narration-strip" id="ve-narration-strip" hidden>
            <div class="ve-narr-mode-toggle">
              <button class="ve-mode-btn active" id="btn-narr-mode-raw">Raw Mic</button>
              <button class="ve-mode-btn" id="btn-narr-mode-filtered">OBS Filtered</button>
            </div>
            <button class="ve-ctrl-btn ve-rec-btn" id="btn-ve-narrate-record">Record</button>
            <button class="ve-ctrl-btn" id="btn-ve-narrate-stop" hidden>Stop</button>
            <button class="ve-ctrl-btn" id="btn-ve-narration-setup" hidden title="Setup VB-Cable for high-quality narration capture">Setup</button>
            <select id="ve-caption-theme" class="ve-theme-select">
              <option value="clean" style="font-family:'Inter',sans-serif">Clean</option>
              <option value="bold_impact" style="font-family:'Poppins',sans-serif;font-weight:900">Bold Impact</option>
              <option value="neon" style="font-family:'Inter',sans-serif;font-weight:700">Neon</option>
              <option value="party" style="font-family:'Poppins',sans-serif;font-weight:700">Party</option>
              <option value="retro" style="font-family:'JetBrains Mono',monospace">Retro</option>
              <option value="handwritten" style="font-family:'Poppins',sans-serif;font-style:italic">Handwritten</option>
            </select>
            <div class="ve-narr-boundary-toggle">
              <span class="ve-narr-label">At clip:</span>
              <button class="ve-mode-btn active" id="btn-boundary-stop">Stop</button>
              <button class="ve-mode-btn" id="btn-boundary-overtake">Overtake</button>
            </div>
            <div class="ve-mic-meter" id="ve-mic-meter"><div class="ve-mic-meter-fill" id="ve-mic-meter-fill"></div></div>
            <span class="ve-narration-status" id="ve-narration-status">Ready</span>
            <span class="ve-narration-audio-badge" id="ve-narration-audio-badge" hidden>Audio saved</span>
          </div>

          <div class="ve-narration-track-container" id="ve-narration-track" hidden>
            <canvas id="ve-narration-track-canvas" height="28"></canvas>
          </div>

          <div class="ve-caption-editor" id="ve-caption-editor" hidden>
            <div class="ve-caption-editor-header">
              <span>Captions</span>
              <div class="ve-caption-editor-actions">
                <button class="ve-ctrl-btn" id="btn-ve-import-live-captions" hidden>Import Live</button>
                <button class="ve-ctrl-btn" id="btn-ve-caption-merge">Merge</button>
                <button class="ve-ctrl-btn" id="btn-ve-caption-split">Split</button>
                <button class="ve-ctrl-btn" id="btn-ve-caption-clear">Clear All</button>
              </div>
              <button class="ve-props-close" id="btn-ve-caption-close">&times;</button>
            </div>
            <div class="ve-caption-list" id="ve-caption-list"></div>
          </div>
        </div>

        <div class="ve-file-browser" id="ve-file-browser" hidden>
          <div class="ve-file-header">
            <h3>Recordings</h3>
            <button class="btn-secondary" id="btn-ve-refresh-files">Refresh</button>
          </div>
          <div class="ve-file-list" id="ve-file-list"></div>
        </div>
      </section>

      <section class="module panel" id="ai-panel" data-panel="ai">
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="mod-title">AI Assistant</span>
        <div class="ai-header">
          <h2><span class="ai-title-observe">OBServer</span> <span class="ai-title-ai">AI</span></h2>
          <div class="ai-header-buttons">
            <button class="btn-secondary btn-help" id="btn-ai-help" title="What can I ask?">?</button>
          </div>
        </div>
        <div id="ai-help-overlay" class="ai-help-overlay" hidden>
          <div class="ai-help-content">
            <div class="ai-help-title">What can OBServer AI do?</div>
            <div class="ai-help-section">
              <div class="ai-help-label">Audio Control</div>
              <div class="ai-help-examples">
                "Turn down the music"<br>
                "My mic is too quiet"<br>
                "Mute desktop audio"
              </div>
            </div>
            <div class="ai-help-section">
              <div class="ai-help-label">Audio Engineering</div>
              <div class="ai-help-examples">
                "Add a noise gate to my mic"<br>
                "Set up a compressor for voice"<br>
                "There's echo on my stream"
              </div>
            </div>
            <div class="ai-help-section">
              <div class="ai-help-label">Scene &amp; Streaming</div>
              <div class="ai-help-examples">
                "Switch to my gameplay scene"<br>
                "Start recording"<br>
                "What's my current setup?"
              </div>
            </div>
            <div class="ai-help-section">
              <div class="ai-help-label">Smart Presets</div>
              <div class="ai-help-examples">
                Use <b>Smart Presets</b> on the Signal Chain panel:<br>
                Tutorial, Gaming, Podcast, Music/DJ,<br>
                Broadcast, ASMR, Noisy Room, Just Chatting, Singing<br>
                <b>PRO:</b> Pro Broadcast, Pro Podcast, Pro Music, Streamer Safety
              </div>
            </div>
            <button class="btn-secondary ai-help-close" id="btn-ai-help-close">Got it</button>
          </div>
        </div>
        <div id="ai-no-key" class="ai-notice">Enter your Gemini API key in Settings to enable OBServer AI.</div>
        <div id="ai-chat" hidden>
          <div id="chat-messages" class="chat-messages"></div>
          <div class="chat-input-row">
            <input type="text" id="chat-input" placeholder="Ask OBServer AI anything...">
            <button id="btn-voice" class="voice-btn" title="Voice input (or hold Ctrl+Space)">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
              </svg>
            </button>
            <button id="btn-chat-send">Send</button>
          </div>
        </div>
      </section>

      <div class="rack-bottom-cap">
        <div class="mod-screw tl"></div><div class="mod-screw tr"></div>
        <div class="mod-screw bl"></div><div class="mod-screw br"></div>
        <span class="rack-bottom-text">OBServe v0.1.0</span>
      </div>

    </div>

    <div class="wood-panel right">
      <div class="wood-screw"></div><div class="wood-screw"></div>
      <div class="wood-screw"></div><div class="wood-screw"></div>
      <div class="wood-screw"></div><div class="wood-screw"></div>
      <div class="wood-screw"></div>
    </div>

  </div>

  <div id="alert-toast" class="alert-toast">
    <span id="alert-toast-msg"></span>
    <button id="alert-toast-dismiss" class="alert-toast-dismiss">X</button>
  </div>

  <div id="ctx-menu" class="ctx-menu" hidden>
    <div id="ctx-menu-items"></div>
  </div>

  <div id="about-modal" class="about-modal-overlay" hidden>
    <div class="about-modal">
      <div class="about-modal-header">
        <span>About OBServe</span>
        <button class="about-modal-close" id="btn-about-close">&times;</button>
      </div>
      <div class="about-modal-body">
        <p class="about-version">OBServe for OBS &mdash; v0.1.0</p>
        <p>OBServe is an independent third-party application. It is not affiliated with, endorsed by, or sponsored by the OBS Project or its contributors.</p>
        <p>OBS&reg; and OBS Studio&reg; are trademarks of the OBS Project.</p>
        <p>OBServe modifies OBS Studio settings via the OBS WebSocket API. Use at your own risk.</p>
        <p>Airwindows audio plugins bundled under MIT license by Chris Johnson.</p>
      </div>
      <div class="about-modal-footer">
        <button class="hw-btn" id="btn-about-footer-close">Close</button>
      </div>
    </div>
  </div>

  <div id="export-modal" class="about-modal-overlay" hidden>
    <div class="about-modal">
      <div class="about-modal-header">
        <span>Export Video</span>
        <button class="about-modal-close" id="btn-export-close">&times;</button>
      </div>
      <div class="about-modal-body">
        <div class="export-form">
          <div class="export-row">
            <label>Filename</label>
            <div style="display:flex;gap:4px;flex:1">
              <input type="text" id="export-filename" style="flex:1" placeholder="output filename">
              <button class="ve-ctrl-btn" id="btn-export-browse">Browse...</button>
            </div>
          </div>
          <div class="export-row">
            <label>Format</label>
            <select id="export-format">
              <option value="mp4">MP4</option>
              <option value="mkv">MKV</option>
              <option value="mov">MOV</option>
            </select>
          </div>
          <div class="export-row" id="export-quality-row">
            <label>Quality</label>
            <select id="export-quality">
              <option value="high">High (CRF 18)</option>
              <option value="medium" selected>Medium (CRF 23)</option>
              <option value="low">Low (CRF 28)</option>
            </select>
          </div>
          <div class="export-row">
            <label>Codec</label>
            <select id="export-codec">
              <option value="copy">Copy (no re-encode, instant)</option>
              <option value="libx264">H.264 (CPU)</option>
              <option value="h264_nvenc">H.264 (NVENC)</option>
              <option value="h264_amf">H.264 (AMF)</option>
              <option value="h264_qsv">H.264 (QSV)</option>
            </select>
          </div>
          <div class="export-row" id="export-captions-row" hidden>
            <label>Captions</label>
            <select id="export-captions-mode">
              <option value="burn">Burn into video</option>
              <option value="srt">Export as SRT</option>
              <option value="both">Both</option>
              <option value="none">None</option>
            </select>
          </div>
          <div class="export-row" id="export-audio-row" hidden>
            <label>Audio</label>
            <select id="export-audio-mode">
              <option value="captions_only">Original audio (captions only)</option>
              <option value="mute_all">Mute all audio</option>
              <option value="narration_replaces">Narration replaces original</option>
              <option value="duck">Duck original during speech</option>
            </select>
          </div>
          <div class="export-row" id="export-narration-vol-row" hidden>
            <label>Narration Vol</label>
            <input type="range" id="export-narration-vol" min="0" max="200" value="100">
            <span id="export-narration-vol-label" style="font-size:0.75rem;color:var(--cream);min-width:32px">100%</span>
          </div>
        </div>
        <div class="export-progress-section" id="export-progress-section" hidden>
          <div class="export-progress-bar">
            <div class="export-progress-fill" id="export-progress-fill"></div>
          </div>
          <div class="export-progress-info">
            <span id="export-progress-pct">0%</span>
            <span id="export-eta"></span>
          </div>
        </div>
      </div>
      <div class="about-modal-footer">
        <button class="hw-btn" id="btn-export-start">Export</button>
        <button class="hw-btn" id="btn-export-cancel" hidden>Cancel</button>
      </div>
    </div>
  </div>

  <div id="ffmpeg-setup-modal" class="about-modal-overlay" hidden>
    <div class="about-modal" style="max-width:420px">
      <div class="about-modal-header">
        <span>FFmpeg Setup</span>
        <button class="about-modal-close" id="btn-ffmpeg-close">&times;</button>
      </div>
      <div class="about-modal-body">
        <p style="margin:0 0 8px;font-size:0.8rem;color:var(--cream-dim)">FFmpeg is needed for video thumbnails, MKV remux, and export. MP4 playback works without it.</p>
        <div id="ffmpeg-setup-status" style="margin-bottom:8px"></div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <button class="hw-btn" id="btn-ffmpeg-winget" style="width:100%">Install via winget (recommended)</button>
          <button class="hw-btn" id="btn-ffmpeg-browse" style="width:100%">Browse for ffmpeg.exe...</button>
          <button class="hw-btn" id="btn-ffmpeg-retry" style="width:100%">Re-detect FFmpeg</button>
        </div>
      </div>
    </div>
  </div>

  <div id="ve-overlay-props" class="ve-overlay-props-panel" hidden>
    <div class="ve-props-header">
      <span>Overlay Properties</span>
      <button class="ve-props-close" id="btn-ve-props-close">&times;</button>
    </div>
    <div class="ve-props-body">
      <div class="export-row"><label>Text</label><input type="text" id="ve-prop-text"></div>
      <div class="export-row"><label>Font Size</label><input type="number" id="ve-prop-fontsize" value="24" min="8" max="200"></div>
      <div class="export-row"><label>Color</label><input type="color" id="ve-prop-color" value="#ffffff"></div>
      <div class="export-row"><label>Opacity</label><input type="range" id="ve-prop-opacity" min="0" max="1" step="0.1" value="1"></div>
      <div class="export-row">
        <label>Position</label>
        <select id="ve-prop-position">
          <option value="custom">Custom (drag)</option>
          <option value="top-left">Top Left</option>
          <option value="top-center">Top Center</option>
          <option value="top-right">Top Right</option>
          <option value="center">Center</option>
          <option value="bottom-left">Bottom Left</option>
          <option value="bottom-center">Bottom Center</option>
          <option value="bottom-right">Bottom Right</option>
        </select>
      </div>
      <div class="export-row"><label>Start (s)</label><input type="number" id="ve-prop-start" step="0.1" min="0"></div>
      <div class="export-row"><label>End (s)</label><input type="number" id="ve-prop-end" step="0.1" min="0"></div>
      <button class="hw-btn" id="btn-ve-prop-apply">Apply</button>
      <button class="btn-secondary" id="btn-ve-prop-delete">Remove</button>
    </div>
  </div>

  <script src="webaudio-controls.js"></script>
  <script src="main.js"></script>
</body>
</html>
